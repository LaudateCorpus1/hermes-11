<div ng-controller="QuestStatusCtrl as qc">
    <div class="row">
        <div class="col-md-3 quest-list">
            <div class="quest-list-filter">
                <div>
                    <button class="big-wide-button be-positive" style="margin-bottom: 10px;" ng-click="qc.goToCreatePage()">Create Quest</button>
                </div>
                <div>
                    <label for="creatorFilter">Filter by creator's username:</label>
                </div>
                <div class="row">
                    <div class="col-md-10">
                        <form ng-submit="qc.runNewFilter()">
                            <input id="creatorFilter" type="text" ng-model="qc.filterByCreator" />
                        </form>
                    </div>
                    <div class="col-md-2">
                        <img src="/img/remove_15.png" alt="Clear owner filter field" class="remove-img-button" ng-click="qc.filterByCreator = ''" />
                    </div>
                </div>
                <div style="margin-top: 5px">
                    <label for="queryFilter">Filter by query:</label>
                </div>
                <div class="row">
                    <div class="col-md-10">
                        <form ng-submit="qc.runNewFilter()">
                            <input id="queryFilter" type="text" ng-model="qc.queryInput" />
                        </form>
                    </div>
                    <div class="col-md-2">
                        <img src="/img/remove_15.png" alt="Clear query filter field" class="remove-img-button" ng-click="qc.queryInput = ''" />
                    </div>
                </div>
                <div class="row" style="margin-top: 10px">
                    <div class="col-md-10">
                    </div>
                    <div class="col-md-2">
                        <button type="button" ng-click="qc.runNewFilter()">GO</button>
                    </div>
                </div>
                <div style="padding: 5px 0px 5px 0px">
                    <label>
                        Limit:
                        <select ng-model="qc.limitSetting"
                                ng-model-options="qc.limitOptions"
                                ng-options="optValue for optValue in qc.limitValues()">
                        </select>
                    </label>
                </div>
                <div class="quest-list-page-selector" style="padding-bottom: 5px;">
                    <strong>Page:</strong>
                    <button style="float:none" type="button" ng-click="qc.pageFirst()">First</button>
                    <button style="float:none" type="button" ng-click="qc.pagePrev()">Prev</button>
                    <select style="margin-left: 0px;" ng-model="qc.pageSetting"
                            ng-model-options="qc.limitOptions"
                            ng-options="pageVal for pageVal in qc.pageValues()"></select>
                    <button style="float:none" type="button" ng-click="qc.pageNext()">Next</button>
                    <button style="float:none" type="button" ng-click="qc.pageLast()">Last</button>
                </div>
                <div ng-if="qc.errorMessage" class="error-message" ng-bind="qc.errorMessage"></div>
            </div>
            <div class="quest-list-entry selected"
                 ng-if="!qc.selectedQuest && !qc.errorMessage">
                <div>
                    <img src="/img/loading.gif"/>
                </div>
            </div>
            <div class="overviews">
                <div class="quest-list-entry"
                     ng-repeat="quest in qc.questData | limitTo:qc.limit:qc.offset track by quest.id"
                     ng-class="(qc.selectedQuest.id == quest.id) ? 'selected': ''"
                     ng-click="qc.newQuestSelection(quest)">
                    <div>
                        <strong>Quest {{quest.id}}</strong>
                    </div>
                    <div>{{quest.description}}</div>
                    <div quest-progress-bar class="progbar" data="quest"></div>
                    <div><span style="font-size: .8em">Embarked on: {{quest.embarkTime}}</span>
                    </div>
                    <div><span style="font-size: .8em">Created by: {{quest.creator}}</span></div>
                </div>
            </div>
        </div>
        <div class="col-md-9">
            <div class="row" style="margin-left: 0px">
                <div class="col-md-12">
                    <div ng-if="!qc.selectedQuest && !qc.errorMessage"
                         style="padding: 10px;">
                        <img src="/img/loading.gif"/>
                    </div>
                    <div ng-if="qc.labors" class="quest-details">
                        <div quest-progress-chart
                             colors="qc.colors"
                             types="qc.types"
                             data="qc.selectedQuestDetails"></div>
                        <div class="quest-overview">
                    <span>
                        {{qc.selectedQuestDetails.totalLabors}} total labors.  {{qc.selectedQuestDetails.openLabors}} remain open.
                    </span>
                        </div>
                        <div class="quest-labors">
                            <div class="header row">
                                <div class="col-md-1"></div>
                                <div class="col-md-11 labor-entry row">
                                    <div class="col-md-3">Labor Owner</div>
                                    <div class="col-md-2">Host</div>
                                    <div class="col-md-3">Host Owner</div>
                                    <div class="col-md-4">Labor</div>
                                </div>
                            </div>
                            <div class="owner-group"
                                 ng-repeat="(owner, labors) in qc.labors">
                                <div class="type-group"
                                     ng-repeat="(laborType, details) in labors">
                                    <div class="row"
                                         ng-repeat="host in details.hosts track by $index">
                                        <div class="col-md-1">
                                            <span ng-if="$parent.$first && $first">
                                                <a href="mailto:{{owner}}{{
                                                    owner.indexOf('@') == -1 ? '@' + qc.domain : ''
                                                }}"
                                                   target="_blank"
                                                        >
                                                    <img src="/img/send_email_15.png" alt="Send email to {{owner}}" />
                                                </a>
                                            </span>
                                        </div>
                                        <div class="col-md-11 labor-entry row"
                                             ng-class="qc.selectedLabors.indexOf(host) != -1 ? 'selected': ''"
                                             ng-click="qc.toggleSelect(host)"
                                                >
                                            <div class="col-md-3">
                                                <span ng-if="$parent.$first && $first">
                                                    {{owner}}
                                                </span>
                                            </div>
                                            <div class="col-md-2">{{host}}</div>
                                            <div class="col-md-3">{{qc.hostOwners[host]}}</div>
                                            <div class="col-md-4">{{laborType}}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="quest-actions">
                            <button style="float:left"
                                    ng-click="qc.selectAll()">
                                Select All
                            </button>
                            <button style="float:left"
                                    ng-click="qc.deselectAll()">
                                Deselect All
                            </button>
                    <span>
                    Throw <select ng-disabled="qc.selectedLabors.length == 0"
                                  ng-model="qc.throwableEventTypesSelection"
                                  ng-model-options="qc.selectOptions"
                                  ng-options="optValue.category + ' ' + optValue.state for optValue in qc.throwableTypes">
                    </select> for {{qc.selectedLabors.length}} selected hosts.
                    </span>
                            <button class="create-button be-positive"
                                    ng-click="qc.createEventsModal = true"
                                    ng-disabled="qc.selectedLabors.length == 0">
                                <img ng-if="qc.createInProgress"
                                     src="/img/loading_15.gif"
                                     style="margin: 5px; float: left"/>
                                Throw Events
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div ng-cloak class="modal-wrapper fade" ng-if="qc.createEventsModal">
        <div id="confirmModal" class="modal-dialog" role="dialog">
            <div class="dialog-callout">The event <code>{{qc.selectedEventType.category}} {{qc.selectedEventType.state}}</code> means: {{qc.selectedEventType.description}}</div>
            <div class="dialog-text">
                Are you sure you want to create a <code>{{qc.selectedEventType.category}} {{qc.selectedEventType.state}}</code> event for {{qc.selectedLabors.length}} servers?
            </div>
            <div class="dialog-buttons">
                <button style="float: none" class="big-button be-positive" ng-click="qc.createEvents()">Yes</button>
                <button style="float: none" class="big-button" ng-click="qc.createEventsModal = false">No</button>
            </div>
        </div>
    </div>
</div>
